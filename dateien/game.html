<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Mathefussball</title>
    <style>* { padding: 0; margin: 0; } canvas { background-image: url("bilder/feld-2.png");background-color: #000000; display: block; margin: 0 auto; }</style>
</head>
<body>

<input type="file" id="input" class="selector"/>

<canvas id="myCanvas" width="1920" height="1080"></canvas>

<script>
    var team_blau = [];
    var team_rot = [];
    var aufgaben_ergebnisse = [];
    var aufgaben = [];
    var ergebnisse = [];
    var blau_counter = 0;
    var rot_counter = 0;
    var aufgaben_counter = 0;

    window.onload = function () { 
    if (window.File && window.FileReader && window.FileList && window.Blob) {
        var fileSelected = document.getElementById('input');
        fileSelected.addEventListener('change', function (e) { 
                var fileExtension = /text.*/; 
                var fileTobeRead = fileSelected.files[0];
                if (fileTobeRead.type.match(fileExtension)) { 
                    var fileReader = new FileReader(); 
                    fileReader.onload = function (e) { 
                        content = fileReader.result;
                        parseTxt(content);
                    } 
                    fileReader.readAsText(fileTobeRead); 
                } 
                else { 
                    alert("Achtung! Es muss eine txt Datei ausgewählt werden."); 
                }
        }, false);
    } 
    else { 
        alert("Dateiformat wird nicht unterstützt."); 
    } 
}
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");    
    var rightPressed = false;
    var leftPressed = false;
    var rightClicked = false;
    var leftClicked = false;
    var posArray = [150, 385, 585, 895, 1125, 1425, 1650];
    var position = 3;
    var startX = 895;
    var startY = 555;
    var x = startX;
    var y = startY;
    
    ball = new Image();
    ball.src = 'bilder/ball70px.png';
    ball.onload = function(){
        ctx.drawImage(ball, x, y);
    }

    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);

    document.addEventListener("click", mouseMoveHandler, false);

    function keyDownHandler(e) {
        if(e.key == "Right" || e.key == "ArrowRight") {
            rightPressed = true;
        }   
        else if(e.key == "Left" || e.key == "ArrowLeft") {
            leftPressed = true;
        }
    }

    function keyUpHandler(e) {
        if(e.key == "Right" || e.key == "ArrowRight") {
            move();
            rightPressed = false;
        }
        else if(e.key == "Left" || e.key == "ArrowLeft") {
            move();
            leftPressed = false;
        }
    }

    function mouseMoveHandler(e) {
        var relativeX = e.clientX - canvas.offsetLeft;
        if(relativeX > 0 && relativeX < canvas.width) {
            if(relativeX >= canvas.width/2 && !leftPressed && !rightPressed){
                rightClicked = true;
                move();
                rightClicked = false;
            }
            else if(relativeX < canvas.width/2 && !leftPressed && !rightPressed){
                leftClicked = true;
                move();
                leftClicked = false;
            }
        }
        
    }

    function move(){
        var random = Math.floor(Math.random() * 10);
        if(position == 6){
                x = startX;
                y = startY;
                alert("TOR FÜR BLAU!!!");
                canvas.width = canvas.width;
                ball.onload();
                position = 3;
                return;
        }
        if(position == 0){
                x = startX;
                y = startY;
                alert("TOR FÜR ROT!!!");
                canvas.width = canvas.width;
                ball.onload();
                position = 3;
                return;
        }
        if(rightPressed || rightClicked){
            position++;
            x = posArray[position];
            if(position == 6){
                y = startY;
            }
            else if(random % 2 == 0){
                y += Math.random() * (808 - y);
            }
            else{
                y -= Math.random() * (y - 343);
            }
        }
        if(leftPressed || leftClicked){
            position--;
            x = posArray[position];
            if(position == 0){
                y = startY;
            }
            else if(random % 2 == 0){
                y += Math.random() * (808 - y);
            }
            else{
                y -= Math.random() * (y - 343);
            }
        }
        canvas.width = canvas.width;
        ball.onload();
    }

    function parseTxt(txt_file_as_string) {
    var lines = txt_file_as_string.split('\n');
    team_blau = lines[0].split(',');
    team_rot = lines[1].split(',');
    for (var int = 2; int < lines.size; int++) {
        aufgaben_ergebnisse.add(lines[int]);
    }
}

function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;
  
    // While there remain elements to shuffle...
    while (0 !== currentIndex) {
  
      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;
  
      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }
  
    return array;
  }

function nextPlayer_blue() {
        if (blau_counter == team_blau.size) {
            team_blau = shuffle(team_blau);
            blau_counter = 0;
        }
        return team_blau[blau_counter];
    }

function nextPlayer_red() {
        if (red_counter == team_rot.size) {
            team_rot = shuffle(team_rot);
            rot_counter = 0;
        }
        return team_rot[rot_counter];
    }

function nextAufgabe() {
    if (aufgaben_counter == aufgaben_ergebnisse.size) {
        aufgaben_ergebnisse = shuffle (aufgaben_ergebnisse);
        aufgaben_counter = 0;
        for (var int = 0; int < aufgaben_ergebnisse.size; int++) {
            aufgaben.add(aufgaben_ergebnisse[int].split('=')[0]);
            ergebnisse.add(aufgaben_ergebnisse[int].split('=')[1]);
        }
    }
    return aufgaben[aufgaben_counter];
}
    
    
</script>

</body>
</html>